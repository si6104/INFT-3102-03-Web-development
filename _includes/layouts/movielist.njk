---
layout: layouts/base.njk
---

{# Combine CMS movies and local movies #}
{% set cmsMovies = cmsData.movies if cmsData else [] %}
{% set localMovies = collections.movies if collections.movies else [] %}
{% set allMoviesCombined = cmsMovies.concat(localMovies) %}

<div class="container mx-auto px-4 py-8">
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">{{ title }}</h1>
    <p class="text-gray-600" id="movieCount">Loading movies...</p>
  </div>
  
  <!-- Filters Section -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h2 class="text-xl font-bold text-gray-900 mb-4">Filter Movies</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Search -->
      <div>
        <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-2">Search by Title</label>
        <input 
          type="text" 
          id="searchInput" 
          placeholder="Enter movie title..." 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
      
      <!-- Genre Filter -->
      <div>
        <label for="genreFilter" class="block text-sm font-medium text-gray-700 mb-2">Genre</label>
        <select 
          id="genreFilter" 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="">All Genres</option>
        </select>
      </div>
      
      <!-- Year Filter -->
      <div>
        <label for="yearFilter" class="block text-sm font-medium text-gray-700 mb-2">Year</label>
        <select 
          id="yearFilter" 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="">All Years</option>
        </select>
      </div>
      
      <!-- Rating Filter -->
      <div>
        <label for="ratingFilter" class="block text-sm font-medium text-gray-700 mb-2">
          Min Rating: <span id="ratingValue">0</span>
        </label>
        <input 
          type="range" 
          id="ratingFilter" 
          min="0" 
          max="10" 
          step="0.5" 
          value="0" 
          class="w-full"
        >
      </div>
    </div>
    
    <button 
      id="resetFilters" 
      class="mt-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-lg transition-colors duration-300"
    >
      Reset Filters
    </button>
  </div>
  
  <!-- Movies Grid -->
  <div id="moviesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    {% for movie in allMoviesCombined %}
      <div class="movie-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300" 
           data-title="{{ movie.title or movie.data.title }}" 
           data-genre="{{ movie.genre or movie.data.genre }}" 
           data-year="{{ movie.releaseYear or movie.data.releaseYear or movie.data.year }}" 
           data-rating="{{ movie.rating or movie.data.rating }}">
        <a href="/movies/{{ movie.title | slugify if movie.title else (movie.id or movie.page.fileSlug) }}/" class="block">
          <div class="relative">
            <img 
              src="{{ movie.poster or movie.data.poster or movie.image or movie.data.image or 'https://via.placeholder.com/300x450' }}" 
              alt="{{ movie.title or movie.data.title }}" 
              class="w-full h-96 object-cover"
            >
            {% if movie.source == "contentful" or movie.data.source == "contentful" %}
              <span class="absolute top-2 right-2 bg-green-500 text-white text-xs font-semibold px-3 py-1 rounded-full">
                Contentful
              </span>
            {% else %}
              <span class="absolute top-2 right-2 bg-gray-500 text-white text-xs font-semibold px-3 py-1 rounded-full">
                Local
              </span>
            {% endif %}
          </div>
          <div class="p-4">
            <h3 class="text-xl font-bold text-gray-900 mb-2">{{ movie.title or movie.data.title }}</h3>
            <p class="text-gray-600 text-sm mb-2">
              <span class="font-semibold">Director:</span> {{ movie.director or movie.data.director }}
            </p>
            <p class="text-gray-600 text-sm mb-2">
              <span class="font-semibold">Genre:</span> {{ movie.genre or movie.data.genre }}
            </p>
            <div class="flex justify-between items-center">
              <span class="text-gray-500 text-sm">{{ movie.releaseYear or movie.data.releaseYear or movie.data.year }}</span>
              <span class="bg-yellow-400 text-yellow-900 text-sm font-bold px-2 py-1 rounded">
                ‚≠ê {{ movie.rating or movie.data.rating }}
              </span>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>
  
  <!-- Pagination removed - showing all movies on one page -->
</div>

<script>
// Client-side filtering functionality
document.addEventListener('DOMContentLoaded', function() {
  const movies = document.querySelectorAll('.movie-card');
  const searchInput = document.getElementById('searchInput');
  const genreFilter = document.getElementById('genreFilter');
  const yearFilter = document.getElementById('yearFilter');
  const ratingFilter = document.getElementById('ratingFilter');
  const ratingValue = document.getElementById('ratingValue');
  const resetButton = document.getElementById('resetFilters');
  const movieCount = document.getElementById('movieCount');
  
  // Populate genre and year filters
  const genres = new Set();
  const years = new Set();
  
  movies.forEach(movie => {
    const genre = movie.dataset.genre;
    const year = movie.dataset.year;
    if (genre) genres.add(genre);
    if (year) years.add(year);
  });
  
  // Sort and populate genre dropdown
  Array.from(genres).sort().forEach(genre => {
    const option = document.createElement('option');
    option.value = genre;
    option.textContent = genre;
    genreFilter.appendChild(option);
  });
  
  // Sort and populate year dropdown
  Array.from(years).sort((a, b) => b - a).forEach(year => {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = year;
    yearFilter.appendChild(option);
  });
  
  // Update rating display
  ratingFilter.addEventListener('input', function() {
    ratingValue.textContent = this.value;
    filterMovies();
  });
  
  // Filter function
  function filterMovies() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedGenre = genreFilter.value;
    const selectedYear = yearFilter.value;
    const minRating = parseFloat(ratingFilter.value);
    
    let visibleCount = 0;
    
    movies.forEach(movie => {
      const title = movie.dataset.title.toLowerCase();
      const genre = movie.dataset.genre;
      const year = movie.dataset.year;
      const rating = parseFloat(movie.dataset.rating);
      
      const matchesSearch = title.includes(searchTerm);
      const matchesGenre = !selectedGenre || genre === selectedGenre;
      const matchesYear = !selectedYear || year === selectedYear;
      const matchesRating = rating >= minRating;
      
      if (matchesSearch && matchesGenre && matchesYear && matchesRating) {
        movie.style.display = 'block';
        visibleCount++;
      } else {
        movie.style.display = 'none';
      }
    });
    
    movieCount.textContent = `Showing ${visibleCount} of ${movies.length} movies`;
  }
  
  // Reset filters
  resetButton.addEventListener('click', function() {
    searchInput.value = '';
    genreFilter.value = '';
    yearFilter.value = '';
    ratingFilter.value = '0';
    ratingValue.textContent = '0';
    filterMovies();
  });
  
  // Add event listeners
  searchInput.addEventListener('input', filterMovies);
  genreFilter.addEventListener('change', filterMovies);
  yearFilter.addEventListener('change', filterMovies);
  
  // Initial count
  filterMovies();
});
</script>